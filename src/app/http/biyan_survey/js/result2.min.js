function showBtips(){$("#box").slideToggle(400)}function returnSurvey(a){window.localStorage.setItem(ss+"go","gosurvey"),window.location.replace(sp)}function getReturnUrl(){cancelAnimationFrame(iout);var a=window.localStorage.getItem("returnurl");window.location.replace(decodeURIComponent(a))}function jumptohl(){window.location.replace("http://www.ihaola.com.cn/code.html")}function resultpage_init(a,b,c,d,e,f,g,h,j,k,l,m){function n(){a.innerWidth>a.innerHeight?(I.width=a.innerWidth,I.height=a.innerHeight*t[0],J.width=a.innerWidth,J.height=a.innerHeight*t[1],K.width=a.innerWidth,K.height=a.innerHeight*t[2]):(I.width=a.innerWidth,I.height=a.innerHeight*t[0],J.width=a.innerWidth,J.height=a.innerHeight*t[1],K.width=a.innerWidth,K.height=a.innerHeight*t[2])}if(chartType=d,a.localStorage.getItem(c+"ori")){var o=0,p=0,q=1,r=[61.8,85.4,100],s=[40,85.4,100],t=[.9,.6,.7],u=c;ss=String(u),sp=f;var v=JSON.parse(a.localStorage.getItem(ss+"ori"));surveyContent=JSON.parse(a.localStorage.getItem(ss+"surveyContent")),null==e&&(e=surveyContent.type);var w=(a.localStorage.getItem(ss+"badge3"),a.localStorage.getItem(ss+"badge4"),[]),x=v.scores[1]||8,y=v.scores[0];y>94&&(y=95),0>=y&&(y=2);var z,A=1,B=1;if(v.scores.length>10){for(i=1;i<v.scores.length;i++)v.scores[i]>0&&(sScores[B-1]=v.scores[i],w[B-1]=surveyContent.categories[i].name,sDesc[B-1]=surveyContent.categories[i].description,x<sScores[B-1]&&(x=sScores[B-1],A=B),B++);if(z=sScores.length,10>z)for(i=1;i<v.scores.length&&!(v.scores[i]<=0&&(sScores[z]=8,w[z]=surveyContent.categories[i].name,sDesc[z]=surveyContent.categories[i].description,z++,10==z));i++);}else for(i=1;i<v.scores.length;i++)sScores[i-1]=v.scores[i],w[i-1]=surveyContent.categories[i].name,sDesc[i-1]=surveyContent.categories[i].description,x<v.scores[i]&&(x=v.scores[i],A=i),sScores[i-1]<=0&&(sScores[i-1]=8);var C=function(a){return function(b,c){var d,e;if("object"==typeof b&&"object"==typeof c&&b&&c)return d=b[a],e=c[a],d===e?0:typeof d==typeof e?e>d?-1:1:typeof e>typeof d?-1:1;throw"error"}},D=function(a){for(var b=a.substr(0,a.indexOf(".")),c=a.substr(a.indexOf(".")+1),d=surveyContent.questions.length,e=0,f="";d--&&0==e;)if(surveyContent.questions[d].qid==b){var g=surveyContent.questions[d].option_list[c].description;surveyContent.questions[d].option_list[c].choice_id;"7871405f-de94-7406-de55-f18e26cb4345"==F&&(g="120"==b?"大姨妈期间"+g:"平时"+g),e=1}var h=[g,f];return h},E=function(a){for(var b=v.match_detail2.length,c=0;b--&&0==c;)if(v.match_detail2[b]._id==a){var d=v.match_detail2[b].count;c=1}return d>0?d:1},F=u,G=0;for(v.match_detail1&&(G=v.match_detail1.length),rMatrix=[],i=0;i<G;i++)rMatrix[i]={rID:v.match_detail1[i]._id,rPeople:v.match_detail1[i].count,rPercent:100*E(v.match_detail1[i]._id)/v.match_detail1[i].count};rMatrix.sort(C("rPeople"));var H=0;for(i=0;i<rMatrix.length-1;i++)rMatrix[i].rPeople<15&&H++;H>0&&rMatrix.splice(0,H),rMatrix.sort(C("rPercent"));var I=b.getElementById("d_canvas"),J=b.getElementById("t_canvas"),K=b.getElementById("s_canvas");switch(chartType){default:n();var L=b.getElementById("d_canvas").getContext("2d"),M=b.getElementById("t_canvas").getContext("2d"),N=b.getElementById("s_canvas").getContext("2d"),O=L.canvas.width,P=L.canvas.height,Q=M.canvas.width,R=M.canvas.height,S=N.canvas.width,T=N.canvas.height;a.devicePixelRatio&&(L.canvas.style.width=O+"px",L.canvas.style.height=P+"px",L.canvas.height=P*a.devicePixelRatio,L.canvas.width=O*a.devicePixelRatio,M.canvas.style.width=Q+"px",M.canvas.style.height=R+"px",M.canvas.height=R*a.devicePixelRatio,M.canvas.width=Q*a.devicePixelRatio,N.canvas.style.width=S+"px",N.canvas.style.height=T+"px",N.canvas.height=T*a.devicePixelRatio,N.canvas.width=S*a.devicePixelRatio)}}else a.location.replace(f);return function(b){function c(a,b,c,d,e,f,g,h){var i=new Image;i.onload=function(){e.drawImage(i,a,b,c,d),e.beginPath(),e.fillStyle="#383838",e.font="bold "+Math.ceil(h)+"px 微软雅黑",e.textAlign="left",e.textBaseline="top",e.fillText(g,a+2*c,b)},i.src="http://www.ihaola.com.cn/images/"+String(f)+".png"}function d(a,b,c,d,e,f){var g=new Image;g.onload=function(){e.drawImage(g,a,b,c,d)},g.src="http://www.ihaola.com.cn/images/"+String(f)+".png"}function f(a,b,c,d,e){L.beginPath(),L.fillStyle=d,L.fillRect(a,b,c,c),L.closePath(),L.beginPath(),L.fillStyle="#000000",L.font=Math.ceil(c)+"px 微软雅黑",L.textAlign="left",L.textBaseline="top",L.fillText(e,a+.12*P,b)}function g(a){return a<=s[0]?r[0]/s[0]:a>s[0]&&a<=s[1]?(r[0]+(a-s[0])*((r[1]-r[0])/(s[1]-s[0])))/a:a>s[1]&&100>=a?(r[1]+(a-s[1])*((r[2]-r[1])/(s[2]-s[1])))/a:1}function h(){var a;for(L.clearRect(0,.05*B+.06*z,I.width,.6*I.height),jj=3;jj>0;jj--){for(L.beginPath(),L.moveTo(G/2,H/2+O-E*P*r[jj-1]/100),i=1;i<F;i++)L.lineTo(G/2+Math.sin(360*i/F*Math.PI/180)*E*P*r[jj-1]/100,H/2+O-Math.cos(360*i/F*Math.PI/180)*E*P*r[jj-1]/100);L.closePath(),L.fillStyle=Q[jj-1],L.fill()}for(i=0;i<F;i++)L.beginPath(),L.moveTo(G/2,H/2+O),L.lineTo(G/2+Math.sin(360*i/F*Math.PI/180)*P*E,H/2+O-Math.cos(360*i/F*Math.PI/180)*P*E),L.lineWidth=1,L.strokeStyle="#ffffff",L.stroke();for(L.beginPath(),L.moveTo(G/2+Math.sin(0)*g(sScores[0])*P*p*E*(sScores[0]/x)/100,H/2+O-Math.cos(0)*g(sScores[0])*P*p*E*(sScores[0]/x)/100),i=1;i<F;i++)L.lineTo(G/2+Math.sin(360*i/F*Math.PI/180)*g(sScores[i])*P*p*E*(sScores[i]/x)/100,H/2+O-Math.cos(360*i/F*Math.PI/180)*g(sScores[i])*P*p*E*(sScores[i]/x)/100);for(L.closePath(),L.fillStyle="rgba(255,246,1,0.7)",L.fill(),L.lineWidth=3,L.strokeStyle="rgba(255,255,255,1)",L.stroke(),i=0;i<F;i++)L.beginPath(),L.arc(G/2+Math.sin(360*i/F*Math.PI/180)*g(sScores[i])*P*p*E*(sScores[i]/x)/100,H/2+O-Math.cos(360*i/F*Math.PI/180)*g(sScores[i])*P*p*E*(sScores[i]/x)/100,.04*P,0,2*Math.PI,!1),sScores[i]<=s[0]?L.fillStyle=R[0]:sScores[i]>s[0]&&sScores[i]<=s[1]?L.fillStyle=R[1]:sScores[i]>s[1]&&sScores[i]<=s[2]?L.fillStyle=R[2]:L.fillStyle=R[2],L.fill(),L.lineWidth=3,L.strokeStyle="rgba(255,255,255,1)",L.stroke();for(i=0;i<F;i++)a=360*i/F>89&&360*i/F<271?.2*P:-.2*P,p>x-1&&i==A-1&&x>s[0]?L.fillStyle="rgb(255,0,0)":L.fillStyle="#5c5c5c",L.font=Math.ceil(.09*P)+"px 微软雅黑",L.textAlign="center",L.textBaseline="middle",L.fillText(w[i],G/2+Math.sin(360*i/F*Math.PI/180)*P*E,H/2+O-Math.cos(360*i/F*Math.PI/180)*P*E+a);f(.86*G,.12*H,.08*P,Q[2],"高"),f(.86*G,.15*H,.08*P,Q[1],"中"),f(.86*G,.18*H,.08*P,Q[0],"低"),p+=1}function j(){x+1>p&&(h(),iout=requestAnimationFrame(j))}function l(a,b,c,d,e,f,g,h,i){M.clearRect(a,b,c,d);var j=parseInt(e.length/13);for(M.beginPath(),M.fillStyle="#333333",M.font=Math.ceil(.25*d)+"px 微软雅黑",M.textAlign="left",M.textBaseline="middle",ivx=0;ivx<j+1;ivx++)M.fillText(e.substr(13*ivx,13),a+.1*c,b+d/2-d/8*j+d/4*ivx);M.beginPath(),M.arc(a+.92*c,b+d/2,.48*d/2,0,2*Math.PI,!1),M.closePath(),M.fillStyle="#cccccc",M.fill(),M.beginPath(),M.arc(a+.92*c,b+d/2,.46*d/2,0,2*Math.PI,!1),M.closePath(),M.fillStyle="#ffffff",M.fill(),M.beginPath(),M.moveTo(a+.92*c,b+d/2),M.lineTo(a+.92*c,b+.2*d/2),M.arc(a+.92*c,b+d/2,.46*d/2,1.5*Math.PI,(.02*f-.5)*Math.PI,!1),M.lineTo(a+.92*c,b+d/2),M.closePath(),M.fillStyle=h,M.fill(),100==f&&(M.beginPath(),M.arc(a+.92*c,b+d/2,.43*d/2,0,2*Math.PI,!1),M.closePath(),M.fillStyle=vColor[0],M.fill()),M.beginPath(),M.fillStyle="#333333",M.font=Math.ceil(.2*d)+"px 微软雅黑",M.textAlign="center",M.textBaseline="middle",M.fillText(String(f)+"%",a+.92*c,b+d/2)}function m(a,b,c,d){M.fillStyle="#888888",M.font=Math.ceil(.1*d)+"px 微软雅黑",M.textAlign="left",M.fillText("与您症状相同的"+String(t())+"位用户，有效性排名前五的方法！",a+.05*c,.9*V)}function n(){var a=Math.max(0,rMatrix.length-5);for(i=0;i<Math.min(5,rMatrix.length);i++){var b=D(rMatrix[a+i].rID);l(.05*U,.12*(5-i)*V+.1*V,.9*U,.12*V,b[0],(q*rMatrix[a+i].rPercent/vPsum).toFixed(0),rMatrix[a+i].rPeople,vColor[4],5-i)}m(.05*U,.76*V,U,.3*V)}function t(){var a=21;for(i=0;i<rMatrix.length-1;i++)rMatrix[i].rPeople>a&&(a=rMatrix[i].rPeople);return a}function u(){N.clearRect(0,0,K.width,K.height),N.beginPath(),N.arc(W/2,X/2+Y,Z,Math.PI/6,5*Math.PI/6,!0),N.arc(W/2+Math.sin(240*Math.PI/180)*((Z+$)/2),X/2+Y-Math.cos(240*Math.PI/180)*((Z+$)/2),($-Z)/2,11*Math.PI/6,5*Math.PI/6,!1),N.arc(W/2,X/2+Y,$,5*Math.PI/6,Math.PI/6,!1),N.arc(W/2+Math.sin(120*Math.PI/180)*((Z+$)/2),X/2+Y-Math.cos(120*Math.PI/180)*((Z+$)/2),($-Z)/2,1*Math.PI/6,7*Math.PI/6,!1),N.closePath(),N.fillStyle="#33b8e1",N.fill(),N.strokeStyle="#33b8e1",N.lineWidth=1,N.stroke(),N.shadowOffsetX=0,N.shadowOffsetY=0,N.shadowBlur=0;var a,b,c,d,e=.05;for(i=0;i<18;i++)i>6&&i<12||(i<7?(a=_[i+6],b=10*i+60):(a=_[i-12],b=10*i-120),N.beginPath(),N.arc(W/2+Math.sin(20*i*Math.PI/180)*(Z+$)/2,X/2+Y-Math.cos(20*i*Math.PI/180)*(Z+$)/2,($-Z)/4,0,2*Math.PI),N.strokeStyle="rgba(0,0,255,0.25)",N.lineWidth=1,N.stroke(),N.fillStyle=a,N.fill(),i%3==0&&(N.beginPath(),N.moveTo(W/2+Math.sin(20*i*Math.PI/180)*Z*.9,X/2+Y-Math.cos(20*i*Math.PI/180)*Z*.9),N.lineTo(W/2+Math.sin(20*i*Math.PI/180)*Z*(.8+e),X/2+Y-Math.cos(20*i*Math.PI/180)*Z*(.8+e)),N.strokeStyle="#000000",N.lineWidth=1,N.stroke(),N.beginPath(),N.fillStyle="#33b8e1",N.font=Math.ceil(.1*P)+"px 微软雅黑",N.textAlign="center",N.textBaseline="middle",0==b&&(1==k?(c=aa[2],d=2):(c=aa[0],d=1)),120==b&&(1==k?(c=aa[3],d=1):(c=aa[1],d=2)),(0==b||120==b)&&v(W/2+Math.sin(20*i*Math.PI/180)*$*(1.1+e),X/2+Y-Math.cos(20*i*Math.PI/180)*$*(1.1+e)+.15*P,(Z+$)/25,d),N.fillStyle="#33b8e1",N.fillText(b/1.2,W/2+Math.sin(20*i*Math.PI/180)*$*(1.1+e),X/2+Y-Math.cos(20*i*Math.PI/180)*$*(1.1+e))));var f,g,h,j;f=240+2*o,g=330+2*o,h=60+2*o,j=150+2*o,N.shadowOffsetX=1,N.shadowOffsetY=1,N.shadowBlur=2,N.shadowColor="rgba(70,80,90,0.8)",N.beginPath(),N.moveTo(W/2+Math.sin(f*Math.PI/180)*Z,X/2+Y-Math.cos(f*Math.PI/180)*Z),N.lineTo(W/2+Math.sin(g*Math.PI/180)*(.1*P),X/2+Y-Math.cos(g*Math.PI/180)*(.1*P)),N.lineTo(W/2+Math.sin(h*Math.PI/180)*(.2*P),X/2+Y-Math.cos(h*Math.PI/180)*(.2*P)),N.lineTo(W/2+Math.sin(j*Math.PI/180)*(.1*P),X/2+Y-Math.cos(j*Math.PI/180)*(.1*P)),N.closePath(),N.fillStyle="#33b8e1",N.fill(),N.shadowOffsetX=1,N.shadowOffsetY=1,N.shadowBlur=4,N.shadowColor="rgba(70,80,90,0.8)",N.beginPath(),N.arc(W/2,X/2+Y,.1*P,0,2*Math.PI),N.lineWidth=1,N.strokeStyle="rgba(70,80,90,1)",N.stroke(),N.fillStyle="rgba(197,245,255,1)",N.fill(),N.shadowOffsetX=0,N.shadowOffsetY=0,N.shadowBlur=0,N.beginPath(),N.arc(W/2,X/2+Y,2,0,2*Math.PI),N.closePath(),N.fillStyle="#5c5c5c",N.fill(),N.shadowBlur=0,N.fillStyle="#33b8e1",N.font=Math.ceil(.45*P)+"px 微软雅黑",N.textAlign="center",N.textBaseline="middle",N.fillText(Math.round(o/1.2),W/2,Math.ceil(X/2+Y+.8*P)),N.fillStyle="#c8c8c8",N.font=Math.ceil(.12*P)+"px 微软雅黑",N.textAlign="center";var l;l=1==k?"指数越高越好":"指数越低越好",N.fillText(l,W/2,.9*K.height)}function v(a,b,c,d){N.beginPath(),N.arc(a,b,c,0,2*Math.PI),N.fillStyle="rgba(255,221,0,1)",N.fill(),N.lineWidth=1,N.strokeStyle="#cccccc",N.stroke(),N.beginPath(),N.fillStyle="#333333",N.arc(a+Math.sin(45*Math.PI/180)*c/2,b-Math.cos(45*Math.PI/180)*c/2,c/10,0,2*Math.PI),N.fill(),N.beginPath(),N.arc(a+Math.sin(315*Math.PI/180)*c/2,b-Math.cos(315*Math.PI/180)*c/2,c/10,0,2*Math.PI),N.fill(),N.beginPath(),N.strokeStyle="#333333",N.lineWidth=c/10,1==d?N.arc(a,b,c/2,45*Math.PI/180,135*Math.PI/180):N.arc(a,b+c,2*c/3,225*Math.PI/180,315*Math.PI/180),N.stroke()}requestAnimationFrame=a.requestAnimationFrame||a.mozRequestAnimationFrame||a.webkitRequestAnimationFrame||a.msRequestAnimationFrame,cancelAnimationFrame=a.cancelAnimationFrame||a.mozCancelAnimationFrame,selectPage=b,tout&&a.clearTimeout(tout),iout&&cancelAnimationFrame(iout);var z=I.width,B=I.height,C=.5*I.width*.1;c(.05*z,.05*B,.06*z,.06*z,L,"i1","鼻炎评估报告",C),c(.05*z,.05*B,.06*z,.06*z,M,"i2","应对方法及有效性",C),c(.05*z,.05*B,.07*z,.06*z,N,"i3","鼻炎指数",C),p=0;var E,F=sScores.length,G=I.width,H=I.height,O=-.025*I.height,P=1.5*Math.min(H/2,G/2)/3,Q=["#8ce9d2","#6fdbff","#6ecfff","rgba(250,250,250,0.8)"],R=["rgba(0,225,0,1)","rgba(255,255,0,1)","#ee734d","rgba(250,250,250,1)"];E=.85,L.font="bold "+Math.ceil(.12*P)+"px 微软雅黑";var S="您的"+e+"类型偏向于"+w[A-1],T=L.measureText(S).width/2;L.beginPath(),L.lineCap="round",L.moveTo(.05*G+G/7-.1*P,.9*H),L.lineTo(.05*G+G/7+2*T+.25*P,.9*H),L.strokeStyle="#4ebfe6",L.lineWidth=.5*P,L.stroke(),L.beginPath(),L.fillStyle="#ffffff",L.font="bold "+Math.ceil(.12*P)+"px 微软雅黑",L.textAlign="left",L.fillText(S,.05*G+G/7+.05*P,.9*H),d(.05*G,.9*H+.25*P-1.526*G/7,G/7,1.526*G/7,L,"doc1"),requestAnimationFrame(j),vPercent=[12,23,35,57,68],vPsum=60,vColor=["rgb(242,160,174)","rgb(228,212,189)","rgb(90,104,153)","rgb(105,185,223)","#f47d5b"],q=vPsum;var U=J.width,V=J.height;n(),o=1.2*y+1,a.localStorage.setItem(ss+"badge3","0");var W=K.width,X=.8*K.height,Y=.15*K.height,P=.65*Math.min(X/2,W/2),Z=.9*P,$=1*P,_=["#D7FFEE","#7AFEC6","#02F78E","#FFFFDF","#FFFFAA","#FFFF37","#FFD306","#FFBD9D","#FFAD86","#FF9D6F","#FF8F59","#F75000","#FF5809"],aa=["轻微","严重","异常","正常"];u()}}var selectPage=2,ss,sp,surveyContent={},sDesc=[],sCont=[],sLack=[],sScores=[],tout,iout,requestAnimationFrame,cancelAnimationFrame;